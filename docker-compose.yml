version: '3.8'

services:
  # 后端 API 服务
  api:
    build: .
    container_name: autoftir-api
    ports:
      - "9000:9000"
    environment:
      - HOST=0.0.0.0
      - PORT=9000
      - DEBUG=false
      - AI_PROVIDER=zhipuai_sdk
      - ZHIPUAI_API_KEY=${ZHIPUAI_API_KEY}
      - ZHIPUAI_BASE_URL=${ZHIPUAI_BASE_URL:-https://open.bigmodel.cn/api/paas/v4}
      - VLM_PROVIDER=${VLM_PROVIDER:-openai}
      - VLM_MODEL=${VLM_MODEL:-gpt-4o}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    command: python run_api.py
    restart: unless-stopped

  # Web 前端服务
  frontend:
    build: .
    container_name: autoftir-frontend
    ports:
      - "8501:8501"
    environment:
      - FTIR_BACKEND_URL=http://api:9000
    command: streamlit run streamlit_app.py --server.address=0.0.0.0 --server.port=8501
    depends_on:
      - api
    restart: unless-stopped

networks:
  default:
    name: autoftir-network
